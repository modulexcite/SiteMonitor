<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" DefaultTargets="Test"> 
  <PropertyGroup> 
    <MonitorBuildDir>$(MSBuildProjectDirectory)\build\</MonitorBuildDir>
	<WebMonitorBuildDir>$(MonitorBuildDir)\Web\</WebMonitorBuildDir>

	<TestAssembly>$(MonitorBuildDir)SiteMonitor.Tests.dll</TestAssembly>
	
    <SourceDir>src\</SourceDir>
    <Configuration>Release</Configuration>
    <Platform>Any CPU</Platform>
    <ProductVersion>0.01</ProductVersion>
  </PropertyGroup>

  <ItemGroup>
    <MonitorProjectFile Include="$(SourceDir)\SiteMonitor\SiteMonitor.csproj" />
	<MonitorProjectFile Include="$(SourceDir)\SiteMonitor.Tests\SiteMonitor.Tests.csproj" />
	<WebProjectFile Include="$(SourceDir)\SiteMonitor.UI\SiteMonitor.UI.csproj" />
  </ItemGroup>

  <Import Project="util\msbuild\MSBuild.Community.Tasks.Targets"/>

  <Target Name="Clean">
    <MSBuild Projects="@(MonitorProjectFile)" Targets="Clean" Properties="Configuration=$(Configuration);Platform=$(Platform);OutputPath=$(MonitorBuildDir)"/>
    <DeleteTree Directories="$(MonitorBuildDir)" ContinueOnError="true"/>
  </Target>
 
  <Target Name="GenerateAssemblyInfo">
    <AssemblyInfo CodeLanguage="CS"
               OutputFile="$(SourceDir)\GlobalInfo.cs"
               AssemblyCompany="tucaz"
               AssemblyProduct="SiteMonitor"
               AssemblyTrademark=""
               ComVisible="false"
               CLSCompliant="false"
               AssemblyVersion="$(ProductVersion)"
               AssemblyFileVersion="$(ProductVersion)" />
  </Target>

  <Target Name="BuildMonitor" DependsOnTargets="GenerateAssemblyInfo">
    <MSBuild Projects="@(MonitorProjectFile)" Properties="Configuration=$(Configuration);Platform=$(Platform);OutputPath=$(MonitorBuildDir)"/>
  </Target>
  
  <Target Name="BuildWeb">
	  <RemoveDir Directories="$(WebMonitorBuildDir)"
				 ContinueOnError="true" />
	  <MSBuild Projects="@(WebProjectFile)"
			   Targets="ResolveReferences;_CopyWebApplication"
			   Properties="WebProjectOutputDir=$(WebMonitorBuildDir);
			   OutDir=$(WebMonitorBuildDir)\" />
  </Target>
  
  
  <Target Name="BuildAll">
    <CallTarget Targets="Clean; BuildMonitor; BuildWeb; Test"></CallTarget>
  </Target>

  <Target Name="Rebuild">
    <CallTarget Targets="Clean; BuildMonitor"></CallTarget>
  </Target> 

  <Target Name="Test" DependsOnTargets="BuildMonitor">
    <Nunit Assemblies="$(TestAssembly)" ToolPath="util\nunit"/>
  </Target>

</Project>